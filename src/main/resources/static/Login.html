<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Login</title>
    <style>
        :root { --bg:#0b1020; --panel:#0f1629; --field:#151c2f; --muted:#9aa3b2; --fg:#e7eaf0; --accent:#2563eb; }
        * { box-sizing: border-box; }
        body {
          margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
          background: radial-gradient(1000px 500px at 20% -10%, #1e3a8a33, transparent),
          radial-gradient(900px 500px at 120% 20%, #065f4633, transparent),
          var(--bg);
          color: var(--fg); min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;
        }
        .card {
          width:min(420px, 100%); background: var(--panel); border:1px solid #1e293b;
          border-radius:18px; padding:28px 22px 22px; box-shadow: 0 10px 30px rgba(0,0,0,.35);
        }
        h1 { text-align:center; margin:6px 0 16px; font-size:28px; }
        label { display:block; margin:10px 0 6px; font-size:14px; color:#cdd6e3; }
        input {
          width:100%; padding:12px 12px; background: var(--field); border:1px solid #243144;
          border-radius:12px; color:var(--fg); outline:none; transition:border .15s, box-shadow .15s;
        }
        input:focus { border-color:#35507a; box-shadow:0 0 0 4px #1e3a8a33; }
        .btn {
          width:100%; margin-top:16px; padding:12px 14px; font-weight:600; font-size:15px;
          border-radius:12px; border:none; background:linear-gradient(90deg, var(--accent), #1d4ed8);
          color:white; cursor:pointer; transition:transform .05s ease;
        }
        .btn:active { transform: translateY(1px); }
        .muted { margin-top:12px; text-align:center; color:var(--muted); font-size:14px; }
        .muted a { color:#93c5fd; text-decoration:none; }
        .muted a:hover { text-decoration:underline; }
        .toast {
          position: fixed; top:16px; right:16px; z-index:9999; padding:12px 14px; border-radius:10px;
          background:#143b12; color:#d1fae5; border:1px solid #0f5132; display:none;
        }
        .toast.error { background:#3b0b0b; color:#fee2e2; border-color:#7f1d1d; }
    </style>
</head>
<body>
<div class="toast" id="toast"></div>

<div class="card">
    <h1 id="formTitle">Login</h1>
    <form id="loginForm">
        <label for="email">Email</label>
        <input id="email" type="email" placeholder="you@college.edu" required>

        <label for="password">Password</label>
        <input id="password" type="password" placeholder="••••••••" required>

        <button class="btn" type="submit">Login</button>
        <div class="muted">Don’t have an account? <a id="signupLink" href="#">Sign up</a></div>
    </form>
</div>

<script>
    const API = "http://localhost:8080";
    const toast = document.getElementById('toast');
    const role = new URLSearchParams(window.location.search).get('role') || 'student';

    // Update title and signup link based on role
    const title = document.getElementById('formTitle');
    const signupLink = document.getElementById('signupLink');
    if (role === 'club') {
      title.textContent = 'Login - Club Head';
      signupLink.href = '/signup.html?role=club';
    } else {
      title.textContent = 'Login - Student';
      signupLink.href = '/signup.html?role=student';
    }

    function showToast(msg, isError=false){
      toast.textContent = msg;
      toast.className = 'toast' + (isError ? ' error' : '');
      toast.style.display = 'block';
      setTimeout(() => toast.style.display = 'none', 2600);
    }

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value.trim().toLowerCase();
      const password = document.getElementById('password').value.trim();

      try {
        const res = await fetch(`${API}/api/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        if (!res.ok) {
          const msg = await res.text();
          showToast(msg || 'Invalid credentials', true);
          return;
        }

        const data = await res.json();

        // Route based on returned role
        if (data.role === 'CLUB_HEAD') {
          sessionStorage.setItem('clubId', data.clubId);
          showToast('Welcome, Club Head!');
          setTimeout(() => window.location.href = '/club-dashboard.html', 600);
        } else {
          showToast('Welcome, Student!');
          setTimeout(() => window.location.href = '/student-dashboard.html', 600);
        }
      } catch (err) {
        showToast('Network error. Is the API running on :8080?', true);
      }
    });
</script>
</body>
</html>
